
---

### **产品需求文档 (PRD): “简约记账”APP (原型 V3.1)**

**文档版本:** 3.1 (施工蓝图版 + 技术栈约束)
**日期:** 2025年10月29日

---

### 1. 项目概述与目标

**1.1. 项目目标**
在10天内开发一个可运行于安卓平台的记账APP原型。该原型旨在满足个人的基础记账、查账与统计需求。

**1.2. 核心理念**
应用必须**“离线优先”**，所有功能在没有网络连接时均可正常使用。其数据结构的设计必须为未来的**“多设备同步”**（通过用户自己的云盘）奠定基础，**不得为后续的同步功能设置障碍**。

**1.3. 技术栈约束 (重要)**
* **框架 (Framework):** 必须使用 **React Native** 进行开发。
* **语言 (Language):** 必须使用 **TypeScript** 作为开发语言。

---

### 2. 核心用户流程 (User Flow)

* **导航结构:** 应用采用底部标签栏 (Bottom Tab Navigation) 作为主导航。
    * **Tab 1: 首页 (Home)** - (FR-4.1) 默认启动页面。
    * **Tab 2: 明细 (List)** - (FR-3.2)
    * **Tab 3: 统计 (Stats)** - (FR-4.2, FR-4.3)
    * **Tab 4: 我的 (Settings)** - 账户管理(FR-1)的入口。
* **核心流程 1: 记一笔**
    1.  用户在[首页]、[明细]或[统计]页，点击一个全局的“**+**”按钮（如悬浮按钮）。
    2.  应用以**模态(Modal)**形式弹出 [记账页(FR-3.1)]。
    3.  用户填写表单，点击“保存”。
    4.  （若保存成功）[记账页]关闭，返回到之前的页面（如[首页]）。
* **核心流程 2: 查看与修改**
    1.  用户点击 [明细(Tab)]，进入 [明细列表页(FR-3.2)]。
    2.  用户点击列表中的任意一条交易。
    3.  应用跳转到 [编辑交易页(FR-3.3)]（可复用[记账页]的界面，但预填了数据）。
    4.  用户修改后点击“保存”，或点击“删除”。
    5.  应用返回到 [明细列表页]。
* **核心流程 3: 管理账户**
    1.  用户点击 [我的(Tab)]，进入 [设置页]。
    2.  用户点击“账户管理”选项，进入 [账户列表页(FR-1.2)]。
    3.  用户在此页面可点击“+”添加新账户，或点击已有账户进行编辑。

---

### 3. 功能性需求 (FR) 与 验收标准 (AC)

#### 3.1. 账户管理 (FR-1)

* **FR-1.1: 创建账户**
    * **AC-1 (校验):** 点击“保存”时，必须校验“账户名称”和“初始余额”均已填写。“账户名称”不能为空。
    * **AC-2 (提示):** 若校验失败，必须提示用户错误信息（如：“账户名称不能为空”），且不允许保存。
    * **AC-3 (成功):** 校验通过后，必须创建一条新账户数据，**严格遵守 NFR-2.1 和 NFR-2.2**（生成UUID、createdAt、updatedAt）。
* **FR-1.2: 查看账户列表**
    * **AC-1 (数据):** 必须显示所有`isDeleted=0`的账户。
    * **AC-2 (余额):** 列表必须显示每个账户的“当前余额”。此余额必须**动态计算**得出（= 初始余额 + (所有关联的`isDeleted=0`的收入总和) - (所有关联的`isDeleted=0`的支出总和)）。
* **FR-1.3: 编辑账户**
    * **AC-1 (数据):** 进入页面时，必须预先填入该账户的“账户名称”和“初始余额”。
    * **AC-2 (校验):** “账户名称”不能为空。
    * **AC-3 (成功):** 保存时，必须更新**原记录**的数据，并**严格遵守 NFR-2.2**（更新`updatedAt`时间戳）。
* **FR-1.4: 删除账户**
    * **AC-1 (确认):** 点击“删除”时，必须弹窗提示用户“是否确认删除？”。
    * **AC-2 (执行):** 用户确认后，**不允许**物理删除。必须**严格遵守 NFR-2.3 和 NFR-2.2**（将`isDeleted`标为1，并更新`updatedAt`）。
    * **AC-3 (隐藏):** 被删除的账户不得再出现于[账户列表页]，也不得作为[记账页]的下拉选项。

#### 3.2. 分类管理 (FR-2)

* **FR-2.1: 默认分类**
    * **AC-1 (内置):** 应用必须内置一套合理的（数量不限）支出和收入分类。此项交由开发代理（Codex）先行实现，V1.0中用户不可修改。

#### 3.3. 交易管理 (FR-3)

* **FR-3.1: 记录交易（核心）**
    * **AC-1 (校验):** 点击“保存”时，必须校验“金额”、“交易类型”、“分类”、“账户”、“交易日期”均已正确填写。
    * **AC-2 (提示):** 若校验失败，必须提示用户错误信息（如：“金额必须大于0”），且不允许保存。
    * **AC-3 (金额):** “金额”必须是大于0的数字。
    * **AC-4 (成功):** 校验通过后，必须创建一条新交易数据，**严格遵守所有 NFR-2 (NFR-2.1, 2.2, 2.3)** 的数据架构约束。
    * **AC-5 (流程):** 保存成功后，必须自动关闭[记账页]（如流程2.1所定义）。
* **FR-3.2: 查看交易明细**
    * **AC-1 (数据):** 必须显示所有`isDeleted=0`的交易。
    * **AC-2 (排序):** 列表必须按“交易日期”**降序**排列（最新的在最前）。
    * **AC-3 (分组):** (建议) 列表应按日期进行视觉分组（如：“今天”、“昨天”、“10月27日”）。
* **FR-3.3: 编辑交易**
    * **AC-1 (数据):** 进入页面时，必须预先填入该交易的所有字段数据。
    * **AC-2 (校验):** 校验规则同 FR-3.1 AC-1, AC-2, AC-3。
    * **AC-3 (成功):** 保存时，必须更新**原记录**的数据，并**严格遵守 NFR-2.2**（更新`updatedAt`时间戳）。
* **FR-3.4: 删除交易**
    * **AC-1 (确认):** 点击“删除”时，必须弹窗提示用户“是否确认删除？”。
    * **AC-2 (执行):** 用户确认后，**不允许**物理删除。必须**严格遵守 NFR-2.3 和 NFR-2.2**（将`isDeleted`标为1，并更新`updatedAt`）。

#### 3.4. 统计与看板 (FR-4)

* **FR-4.1: 首页看板（本月）**
    * **AC-1 (时间):** 数据统计范围必须是**当前日历月**（如：10月1日 00:00 至 10月31日 23:59）。
    * **AC-2 (数据):** 必须查询此时间范围内所有`isDeleted=0`的交易。
    * **AC-3 (显示):** 必须在页面显著位置显示三个数字：**总支出**、**总收入**、**结余**（=总收入 - 总支出）。
    * **AC-4 (刷新):** 当一笔新交易被创建(FR-3.1)、编辑(FR-3.3)或删除(FR-3.4)后，此处的三个数字必须**立即**刷新。
* **FR-4.2: 支出分类统计（本月）**
    * **AC-1 (时间):** 统计范围必须是**当前日历月**。
    * **AC-2 (数据):** 必须查询此范围内所有`type='expense'`且`isDeleted=0`的交易。
    * **AC-3 (图表):** 必须提供一个**饼图**，按“分类”汇总显示支出占比。
* **FR-4.3: 支出趋势统计（本月）**
    * **AC-1 (时间):** 统计范围必须是**当前日历月**。
    * **AC-2 (数据):** 必须查询此范围内所有`type='expense'`且`isDeleted=0`的交易。
    * **AC-3 (图表):** 必须提供一个**柱状图**，按“天”汇总显示每日的支出总额。

---

### 4. 非功能性需求 (NFR)

*（本节是对“本次需求”的架构约束，以确保未来扩展性）*

#### 4.1. 性能 (NFR-1)

* **NFR-1.1: 离线优先**
    * **（最高优先级）** APP的所有功能（记账、查看、统计）必须在设备完全离线的情况下无差别运行。所有数据必须首先写入本地存储。

#### 4.2. 数据架构（为未来同步准备） (NFR-2)

* **NFR-2.1: 数据的唯一标识**
    * 系统必须保证**每一条**新创建的数据（包括每一笔交易、每一个账户）在被创建的瞬间，就被分配一个**永久且全局唯一**的标识符 (UUID)。
* **N.2.2: 数据的变更追踪**
    * 系统必须在内部记录每一条数据的**“创建时间”**和**“最后修改时间”**（Unix时间戳）。
    * 当用户执行编辑操作时，该条记录的“最后修改时间”必须被更新。
* **NFR-2.3: 数据的删除处理（关键）**
    * 当用户执行删除操作时，系统**不允许**在物理上从本地存储中永久擦除该条记录。
    * 系统必须采用**“逻辑删除”（Soft Delete）**：即将该条记录标记为“已删除”状态（如 `isDeleted=1`），并更新“最后修改时间”。
    * 所有功能（列表、统计、计算）在查询数据时，都必须**仅**查询`isDeleted=0`的记录。